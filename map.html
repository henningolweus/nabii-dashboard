<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capital Origin Map | NABII</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* NABII Color Palette */
            --navy-dark: #121C27;
            --green-primary: #1A6B18;
            --green-soft: #61CE70;
            --white: #FFFFFF;
            --gray: #4B535D;
            --beige: #ECE6E1;
            --spacing-lg: 40px;
            --spacing-md: 24px;
            --spacing-sm: 16px;
            --font-primary: 'Roboto', sans-serif;
            --font-secondary: 'Public Sans', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--white);
            color: var(--navy-dark);
            font-size: 17px;
            line-height: 27px;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: var(--spacing-lg) var(--spacing-md);
        }

        header {
            text-align: center;
            padding: var(--spacing-lg) var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            background: var(--beige);
        }

        header h1 {
            font-size: clamp(35px, 5vw, 45px);
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        header p {
            font-size: 20px;
            color: var(--gray);
            font-weight: 400;
            line-height: 29px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--green-primary);
            text-decoration: none;
            padding: 12px var(--spacing-md);
            border: 2px solid var(--green-primary);
            border-radius: 11111px;
            margin-bottom: var(--spacing-md);
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: var(--font-secondary);
        }

        .back-link:hover {
            background: var(--green-primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 107, 24, 0.25);
        }

        .info-box {
            background: var(--beige);
            border-left: 4px solid var(--green-primary);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: 8px;
        }

        .info-box strong {
            color: var(--navy-dark);
            font-weight: 600;
        }

        .chart-container {
            background: var(--white);
            border: 2px solid var(--beige);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: box-shadow 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .chart-header {
            margin-bottom: var(--spacing-lg);
        }

        .chart-title {
            font-size: 35px;
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        .chart-subtitle {
            color: var(--gray);
            font-size: 17px;
            font-weight: 400;
            line-height: 27px;
        }

        .chart {
            width: 100%;
            min-height: 500px;
        }

        footer {
            text-align: center;
            padding: var(--spacing-lg) var(--spacing-md);
            margin-top: var(--spacing-lg);
            border-top: 2px solid var(--beige);
            color: var(--gray);
            font-size: 15px;
        }

        @media (max-width: 767px) {
            header h1 {
                font-size: 30px;
            }

            .chart-container {
                padding: var(--spacing-md);
            }

            .chart-title {
                font-size: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Capital Origin Geographic Distribution</h1>
            <p>Investment sources by country across Zambia's ecosystem</p>
        </header>

        <a href="index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Dashboard
        </a>

        <div class="info-box">
            <strong>Note:</strong> This visualization shows the geographic distribution of capital sources investing in Zambia's impact ecosystem. Countries are sized by total investment volume.
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Investment by Country of Origin</h2>
                <p class="chart-subtitle">Total investment and deal count by investor country</p>
            </div>
            <div id="countryChart" class="chart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Top Investing Countries</h2>
                <p class="chart-subtitle">Ranked by total investment volume</p>
            </div>
            <div id="topCountriesChart" class="chart" style="min-height: 600px;"></div>
        </div>

        <footer>
            <p>NABII · Zambia Impact Investment Ecosystem · 2021-2025</p>
        </footer>
    </div>

    <script>
        // NABII Color Palette
        const colors = {
            primary: ['#1A6B18', '#61CE70', '#2E7D32', '#81C784', '#1B5E20', '#4CAF50', '#66BB6A', '#388E3C'],
            green: '#1A6B18',
            greenSoft: '#61CE70',
            navy: '#121C27',
            gray: '#4B535D',
            beige: '#ECE6E1'
        };

        // Common chart options
        const commonChartOptions = {
            chart: {
                fontFamily: 'Roboto, sans-serif',
                foreColor: colors.navy,
                toolbar: {
                    show: true,
                    tools: {
                        download: true,
                        selection: false,
                        zoom: false,
                        zoomin: false,
                        zoomout: false,
                        pan: false,
                        reset: false
                    }
                }
            },
            colors: colors.primary,
            grid: {
                borderColor: colors.beige
            },
            xaxis: {
                labels: {
                    style: {
                        colors: colors.gray,
                        fontSize: '14px',
                        fontFamily: 'Roboto, sans-serif',
                        fontWeight: 500
                    }
                },
                axisBorder: {
                    color: colors.beige
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: colors.gray,
                        fontSize: '14px',
                        fontFamily: 'Roboto, sans-serif',
                        fontWeight: 500
                    }
                }
            },
            legend: {
                fontSize: '14px',
                fontFamily: 'Roboto, sans-serif',
                labels: {
                    colors: colors.navy
                }
            },
            tooltip: {
                theme: 'light',
                style: {
                    fontSize: '14px',
                    fontFamily: 'Roboto, sans-serif'
                }
            }
        };

        // Load country data
        async function loadData() {
            try {
                const response = await fetch('data/country_data.json');
                const countryData = await response.json();
                renderCharts(countryData);
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading country data. Please ensure country_data.json exists in the data/ folder.');
            }
        }

        function renderCharts(countryData) {
            renderCountryDonut(countryData);
            renderTopCountriesBar(countryData);
        }

        function renderCountryDonut(countryData) {
            const series = countryData.map(c => c.total_investment);
            const labels = countryData.map(c => c.country);

            const options = {
                ...commonChartOptions,
                chart: {
                    ...commonChartOptions.chart,
                    type: 'donut',
                    height: 500
                },
                series: series,
                labels: labels,
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%',
                            labels: {
                                show: true,
                                name: {
                                    show: true,
                                    fontSize: '16px',
                                    fontFamily: 'Roboto, sans-serif',
                                    fontWeight: 600,
                                    color: colors.navy
                                },
                                value: {
                                    show: true,
                                    fontSize: '24px',
                                    fontFamily: 'Roboto, sans-serif',
                                    fontWeight: 500,
                                    color: colors.green,
                                    formatter: function (val) {
                                        return '$' + Math.round(parseFloat(val)) + 'M'
                                    }
                                },
                                total: {
                                    show: true,
                                    label: 'Total Investment',
                                    fontSize: '15px',
                                    fontFamily: 'Roboto, sans-serif',
                                    fontWeight: 600,
                                    color: colors.navy,
                                    formatter: function (w) {
                                        const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                        return '$' + Math.round(total) + 'M'
                                    }
                                }
                            }
                        }
                    }
                },
                legend: {
                    ...commonChartOptions.legend,
                    position: 'bottom',
                    horizontalAlign: 'center'
                },
                tooltip: {
                    ...commonChartOptions.tooltip,
                    y: {
                        formatter: function(val, opts) {
                            const dealCount = countryData[opts.seriesIndex].deal_count;
                            return '$' + Math.round(val) + 'M (' + dealCount + ' deals)';
                        }
                    }
                }
            };

            const chart = new ApexCharts(document.querySelector("#countryChart"), options);
            chart.render();
        }

        function renderTopCountriesBar(countryData) {
            // Get top 15 countries
            const top15 = countryData.slice(0, 15);
            const categories = top15.map(c => c.country);
            const values = top15.map(c => c.total_investment);
            const dealCounts = top15.map(c => c.deal_count);

            const options = {
                ...commonChartOptions,
                chart: {
                    ...commonChartOptions.chart,
                    type: 'bar',
                    height: 600
                },
                series: [{
                    name: 'Investment',
                    data: values
                }],
                xaxis: {
                    ...commonChartOptions.xaxis,
                    categories: categories,
                    labels: {
                        ...commonChartOptions.xaxis.labels,
                        style: {
                            ...commonChartOptions.xaxis.labels.style,
                            fontSize: '13px'
                        }
                    }
                },
                yaxis: {
                    ...commonChartOptions.yaxis,
                    title: {
                        text: 'Total Investment (USD Millions)',
                        style: {
                            color: colors.navy,
                            fontSize: '15px',
                            fontWeight: 600
                        }
                    },
                    labels: {
                        ...commonChartOptions.yaxis.labels,
                        formatter: function(val) {
                            return Math.round(val);
                        }
                    }
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        borderRadius: 6,
                        distributed: true,
                        dataLabels: {
                            position: 'top'
                        }
                    }
                },
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return '$' + Math.round(val) + 'M';
                    },
                    offsetX: 30,
                    style: {
                        fontSize: '13px',
                        fontWeight: 600,
                        colors: [colors.navy]
                    }
                },
                legend: {
                    show: false
                },
                tooltip: {
                    ...commonChartOptions.tooltip,
                    y: {
                        formatter: function(val, opts) {
                            const dealCount = dealCounts[opts.dataPointIndex];
                            return '$' + Math.round(val) + 'M (' + dealCount + ' deals)';
                        }
                    }
                }
            };

            const chart = new ApexCharts(document.querySelector("#topCountriesChart"), options);
            chart.render();
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
