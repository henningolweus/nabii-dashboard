<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capital Origin Map | NABII</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* NABII Color Palette */
            --navy-dark: #121C27;
            --green-primary: #1A6B18;
            --green-soft: #61CE70;
            --white: #FFFFFF;
            --gray: #4B535D;
            --beige: #ECE6E1;
            --spacing-lg: 40px;
            --spacing-md: 24px;
            --spacing-sm: 16px;
            --font-primary: 'Roboto', sans-serif;
            --font-secondary: 'Public Sans', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--white);
            color: var(--navy-dark);
            font-size: 17px;
            line-height: 27px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: var(--spacing-lg) var(--spacing-md);
        }

        header {
            text-align: center;
            padding: var(--spacing-lg) var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            background: var(--beige);
        }

        header h1 {
            font-size: clamp(35px, 5vw, 45px);
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        header p {
            font-size: 20px;
            color: var(--gray);
            font-weight: 400;
            line-height: 29px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--green-primary);
            text-decoration: none;
            padding: 12px var(--spacing-md);
            border: 2px solid var(--green-primary);
            border-radius: 11111px;
            margin-bottom: var(--spacing-md);
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: var(--font-secondary);
        }

        .back-link:hover {
            background: var(--green-primary);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 107, 24, 0.25);
        }

        .info-box {
            background: var(--beige);
            border-left: 4px solid var(--green-primary);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            border-radius: 8px;
        }

        .info-box strong {
            color: var(--navy-dark);
            font-weight: 600;
        }

        .chart-container {
            background: var(--white);
            border: 2px solid var(--beige);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: box-shadow 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .chart-header {
            margin-bottom: var(--spacing-lg);
        }

        .chart-title {
            font-size: 35px;
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        .chart-subtitle {
            color: var(--gray);
            font-size: 17px;
            font-weight: 400;
            line-height: 27px;
        }

        #worldMap {
            width: 100%;
            height: 600px;
        }

        #countryDetails {
            background: var(--beige);
            border: 2px solid var(--green-primary);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-top: var(--spacing-md);
            display: none;
        }

        #countryDetails.active {
            display: block;
        }

        .detail-title {
            font-size: 25px;
            font-weight: 500;
            color: var(--green-primary);
            margin-bottom: var(--spacing-sm);
        }

        .detail-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
        }

        .detail-stat {
            text-align: center;
        }

        .detail-value {
            font-size: 35px;
            font-weight: 500;
            color: var(--green-primary);
            display: block;
        }

        .detail-label {
            font-size: 15px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .legend-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-md);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 15px;
            border-radius: 3px;
        }

        .legend-text {
            font-size: 14px;
            color: var(--gray);
        }

        footer {
            text-align: center;
            padding: var(--spacing-lg) var(--spacing-md);
            margin-top: var(--spacing-lg);
            border-top: 2px solid var(--beige);
            color: var(--gray);
            font-size: 15px;
        }

        @media (max-width: 767px) {
            header h1 {
                font-size: 30px;
            }

            .chart-container {
                padding: var(--spacing-md);
            }

            .chart-title {
                font-size: 25px;
            }

            #worldMap {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Global Capital Origin Heat Map</h1>
            <p>Interactive world map showing investment sources by country</p>
        </header>

        <a href="index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Dashboard
        </a>

        <div class="info-box">
            <strong>How to use:</strong> Hover over countries to see investment details. Click on a country to view detailed statistics. Darker green indicates higher investment volume.
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Investment by Country of Origin</h2>
                <p class="chart-subtitle">Hover to explore, click for details</p>
            </div>
            <div id="worldMap"></div>
            <div class="legend-container">
                <div class="legend-item">
                    <div class="legend-color" style="background: #E8F5E9;"></div>
                    <span class="legend-text">Low Investment</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #61CE70;"></div>
                    <span class="legend-text">Medium Investment</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #1A6B18;"></div>
                    <span class="legend-text">High Investment</span>
                </div>
            </div>
        </div>

        <div id="countryDetails">
            <h3 class="detail-title" id="detailCountryName">Country Details</h3>
            <div class="detail-stats">
                <div class="detail-stat">
                    <span class="detail-value" id="detailInvestment">$0M</span>
                    <span class="detail-label">Total Investment</span>
                </div>
                <div class="detail-stat">
                    <span class="detail-value" id="detailDeals">0</span>
                    <span class="detail-label">Number of Deals</span>
                </div>
                <div class="detail-stat">
                    <span class="detail-value" id="detailAverage">$0M</span>
                    <span class="detail-label">Average Deal Size</span>
                </div>
                <div class="detail-stat">
                    <span class="detail-value" id="detailShare">0%</span>
                    <span class="detail-label">Share of Total</span>
                </div>
            </div>
        </div>

        <footer>
            <p>NABII · Zambia Impact Investment Ecosystem · 2021-2025</p>
        </footer>
    </div>

    <script>
        // NABII Colors
        const colors = {
            green: '#1A6B18',
            greenSoft: '#61CE70',
            greenLight: '#E8F5E9',
            navy: '#121C27',
            gray: '#4B535D',
            beige: '#ECE6E1'
        };

        // ISO 3166-1 alpha-3 country codes mapping
        const countryCodeMap = {
            'Zambia': 'ZMB',
            'United Kingdom': 'GBR',
            'Switzerland': 'CHE',
            'Netherlands': 'NLD',
            'Canada': 'CAN',
            'United States': 'USA',
            'Côte d\'Ivoire': 'CIV',
            'Sweden': 'SWE',
            'Belgium': 'BEL',
            'Germany': 'DEU',
            'Luxembourg': 'LUX',
            'Norway': 'NOR',
            'Denmark': 'DNK',
            'Mauritius': 'MUS',
            'South Africa': 'ZAF',
            'Finland': 'FIN',
            'Nigeria': 'NGA',
            'Kenya': 'KEN',
            'Singapore': 'SGP',
            'United Arab Emirates': 'ARE',
            'Italy': 'ITA',
            'Tunisia': 'TUN'
        };

        let countryData = [];
        let totalGlobalInvestment = 0;

        // Load country data
        async function loadData() {
            try {
                const response = await fetch('data/country_data.json');
                countryData = await response.json();
                totalGlobalInvestment = countryData.reduce((sum, c) => sum + c.total_investment, 0);
                renderWorldMap();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading country data. Please ensure country_data.json exists in the data/ folder.');
            }
        }

        function renderWorldMap() {
            // Prepare data for choropleth map
            const locations = [];
            const values = [];
            const texts = [];
            const customdata = [];

            countryData.forEach(country => {
                const code = countryCodeMap[country.country];
                if (code) {
                    locations.push(code);
                    values.push(country.total_investment);
                    texts.push(country.country);
                    customdata.push({
                        country: country.country,
                        investment: country.total_investment,
                        deals: country.deal_count,
                        average: country.total_investment / country.deal_count,
                        share: (country.total_investment / totalGlobalInvestment * 100)
                    });
                }
            });

            const data = [{
                type: 'choropleth',
                locations: locations,
                z: values,
                text: texts,
                customdata: customdata,
                colorscale: [
                    [0, colors.greenLight],
                    [0.5, colors.greenSoft],
                    [1, colors.green]
                ],
                autocolorscale: false,
                reversescale: false,
                marker: {
                    line: {
                        color: colors.beige,
                        width: 1
                    }
                },
                colorbar: {
                    title: {
                        text: 'Investment<br>(USD M)',
                        font: {
                            family: 'Roboto, sans-serif',
                            size: 14,
                            color: colors.navy
                        }
                    },
                    tickfont: {
                        family: 'Roboto, sans-serif',
                        size: 12,
                        color: colors.navy
                    },
                    tickformat: '$,.0f',
                    thickness: 20,
                    len: 0.7,
                    x: 1.02
                },
                hovertemplate: '<b>%{text}</b><br>' +
                              'Investment: $%{z:.0f}M<br>' +
                              'Deals: %{customdata.deals}<br>' +
                              'Avg Deal: $%{customdata.average:.1f}M<br>' +
                              '<extra></extra>'
            }];

            const layout = {
                geo: {
                    projection: {
                        type: 'natural earth'
                    },
                    showframe: false,
                    showcoastlines: true,
                    coastlinecolor: colors.gray,
                    showland: true,
                    landcolor: '#f5f5f5',
                    showcountries: true,
                    countrycolor: colors.beige,
                    countrywidth: 0.5,
                    bgcolor: colors.white,
                    oceancolor: '#e3f2fd'
                },
                paper_bgcolor: colors.white,
                height: 600,
                margin: { t: 0, b: 0, l: 0, r: 0 },
                font: {
                    family: 'Roboto, sans-serif',
                    color: colors.navy
                },
                hoverlabel: {
                    bgcolor: colors.white,
                    bordercolor: colors.green,
                    font: {
                        family: 'Roboto, sans-serif',
                        size: 14,
                        color: colors.navy
                    }
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['lasso2d', 'select2d', 'pan2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d']
            };

            const mapDiv = document.getElementById('worldMap');
            Plotly.newPlot(mapDiv, data, layout, config);

            // Add click event
            mapDiv.on('plotly_click', function(data) {
                const point = data.points[0];
                showCountryDetails(point.customdata);
            });
        }

        function showCountryDetails(data) {
            const detailsDiv = document.getElementById('countryDetails');

            document.getElementById('detailCountryName').textContent = data.country;
            document.getElementById('detailInvestment').textContent = '$' + Math.round(data.investment) + 'M';
            document.getElementById('detailDeals').textContent = data.deals;
            document.getElementById('detailAverage').textContent = '$' + data.average.toFixed(1) + 'M';
            document.getElementById('detailShare').textContent = data.share.toFixed(1) + '%';

            detailsDiv.classList.add('active');

            // Smooth scroll to details
            detailsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
