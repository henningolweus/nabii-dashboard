<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zambia Impact Investment Dashboard | NABII</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* NABII Color Palette */
            --navy-dark: #121C27;
            --green-primary: #1A6B18;
            --green-soft: #61CE70;
            --white: #FFFFFF;
            --gray: #4B535D;
            --beige: #ECE6E1;
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 24px;
            --spacing-lg: 40px;
            --spacing-xl: 60px;
            --font-primary: 'Roboto', sans-serif;
            --font-secondary: 'Public Sans', sans-serif;
            --font-size-body: 17px;
            --line-height-body: 27px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--white);
            color: var(--navy-dark);
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            overflow-x: hidden;
        }

        .container {
            max-width: 1500px;
            margin: 0 auto;
            padding: var(--spacing-lg) var(--spacing-md);
        }

        /* Header Section */
        header {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            background: var(--beige);
            border-radius: 0;
        }

        header h1 {
            font-size: clamp(35px, 5vw, 45px);
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-sm);
            letter-spacing: -0.5px;
        }

        header p {
            font-size: 20px;
            color: var(--gray);
            font-weight: 400;
            max-width: 800px;
            margin: 0 auto;
            line-height: 29px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }

        .stat-card {
            background: var(--white);
            border: 2px solid var(--beige);
            border-radius: 12px;
            padding: var(--spacing-lg);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--green-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(26, 107, 24, 0.15);
            border-color: var(--green-primary);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-value {
            font-size: 45px;
            font-weight: 500;
            color: var(--green-primary);
            display: block;
            margin-bottom: var(--spacing-xs);
            line-height: 1.2;
        }

        .stat-label {
            font-size: 15px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
            font-family: var(--font-secondary);
        }

        /* Chart Container */
        .chart-container {
            background: var(--white);
            border: 2px solid var(--beige);
            border-radius: 12px;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            transition: box-shadow 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .chart-header {
            margin-bottom: var(--spacing-lg);
        }

        .chart-title {
            font-size: 35px;
            font-weight: 500;
            color: var(--navy-dark);
            margin-bottom: var(--spacing-xs);
            letter-spacing: -0.5px;
        }

        .chart-subtitle {
            color: var(--gray);
            font-size: 17px;
            font-weight: 400;
            line-height: 27px;
        }

        .chart {
            width: 100%;
            min-height: 400px;
        }

        /* Toggle Buttons */
        .toggle-group {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }

        .toggle-btn {
            background: var(--white);
            color: var(--gray);
            border: 2px solid var(--beige);
            padding: 12px var(--spacing-md);
            border-radius: 11111px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            font-family: var(--font-secondary);
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }

        .toggle-btn:hover {
            border-color: var(--green-soft);
            color: var(--green-primary);
            transform: translateY(-2px);
        }

        .toggle-btn.active {
            background: var(--green-primary);
            border-color: var(--green-primary);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(26, 107, 24, 0.25);
        }

        /* Footer */
        footer {
            text-align: center;
            padding: var(--spacing-xl) var(--spacing-md);
            margin-top: var(--spacing-xl);
            border-top: 2px solid var(--beige);
        }

        footer p {
            color: var(--gray);
            font-size: 15px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .chart-title {
                font-size: 30px;
            }

            .stat-value {
                font-size: 35px;
            }
        }

        @media (max-width: 767px) {
            header h1 {
                font-size: 30px;
            }

            .chart-container {
                padding: var(--spacing-md);
            }

            .chart-title {
                font-size: 25px;
            }

            .stat-card {
                padding: var(--spacing-md);
            }
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            color: var(--gray);
            font-size: 17px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Zambia Impact Investment Dashboard</h1>
            <p>Key Insights into Capital Flow and Sectoral Investment Trends</p>
        </header>

        <!-- Summary Statistics -->
        <div class="stats-grid" id="statsGrid"></div>

        <!-- 1. Capital Flow Sankey -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Capital Flow Network</h2>
                <p class="chart-subtitle">Visualizing capital movement from investor types to sectors</p>
            </div>
            <div id="sankeyChart" class="chart" style="min-height: 500px;"></div>
        </div>

        <!-- 2. Sectoral Investment Breakdown -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Sectoral Investment Trends</h2>
                <p class="chart-subtitle">Investment evolution across sectors over time</p>
            </div>
            <div class="toggle-group">
                <button class="toggle-btn active" onclick="toggleSectoralView('value')">Total Value (USD)</button>
                <button class="toggle-btn" onclick="toggleSectoralView('count')">Deal Count</button>
            </div>
            <div id="sectoralChart" class="chart"></div>
        </div>

        <footer>
            <p>NABII · Zambia Impact Investment Ecosystem · 2021-2025</p>
        </footer>
    </div>

    <script>
        // Global data store
        let dashboardData = {};
        let currentSectoralView = 'value';

        // NABII Color Palette for Charts
        const colors = {
            primary: ['#1A6B18', '#61CE70', '#2E7D32', '#81C784', '#1B5E20', '#4CAF50', '#66BB6A', '#388E3C'],
            green: '#1A6B18',
            greenSoft: '#61CE70',
            navy: '#121C27',
            gray: '#4B535D',
            beige: '#ECE6E1'
        };

        // Common ApexCharts configuration
        const commonChartOptions = {
            chart: {
                fontFamily: 'Roboto, sans-serif',
                foreColor: colors.navy,
                toolbar: {
                    show: true,
                    tools: {
                        download: true,
                        selection: false,
                        zoom: false,
                        zoomin: false,
                        zoomout: false,
                        pan: false,
                        reset: false
                    }
                },
                animations: {
                    enabled: true,
                    easing: 'easeinout',
                    speed: 800
                }
            },
            colors: colors.primary,
            grid: {
                borderColor: colors.beige,
                strokeDashArray: 0,
                xaxis: {
                    lines: { show: false }
                },
                yaxis: {
                    lines: { show: true }
                },
                padding: {
                    top: 0,
                    right: 20,
                    bottom: 0,
                    left: 20
                }
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                curve: 'smooth',
                width: 3
            },
            xaxis: {
                labels: {
                    style: {
                        colors: colors.gray,
                        fontSize: '14px',
                        fontFamily: 'Roboto, sans-serif',
                        fontWeight: 500
                    }
                },
                axisBorder: {
                    show: true,
                    color: colors.beige
                },
                axisTicks: {
                    show: false
                }
            },
            yaxis: {
                labels: {
                    style: {
                        colors: colors.gray,
                        fontSize: '14px',
                        fontFamily: 'Roboto, sans-serif',
                        fontWeight: 500
                    }
                }
            },
            legend: {
                position: 'top',
                horizontalAlign: 'left',
                fontSize: '14px',
                fontFamily: 'Roboto, sans-serif',
                fontWeight: 500,
                labels: {
                    colors: colors.navy
                },
                markers: {
                    width: 12,
                    height: 12,
                    radius: 12
                },
                itemMargin: {
                    horizontal: 16,
                    vertical: 8
                }
            },
            tooltip: {
                theme: 'light',
                style: {
                    fontSize: '14px',
                    fontFamily: 'Roboto, sans-serif'
                }
            }
        };

        // Load data files
        async function loadData() {
            try {
                const [sankey, sectoral] = await Promise.all([
                    fetch('data/sankey_data.json').then(r => r.json()),
                    fetch('data/sectoral_data.json').then(r => r.json())
                ]);

                dashboardData = { sankey, sectoral };
                renderDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data. Please ensure data files are in the data/ directory.');
            }
        }

        function renderDashboard() {
            renderStats();
            renderSankey();
            renderSectoralChart();
        }

        function renderStats() {
            const { sankey, sectoral } = dashboardData;

            const totalInvestment = sankey.links.reduce((sum, link) => sum + link.value, 0);
            const totalDeals = sankey.links.reduce((sum, link) => sum + link.deal_count, 0);
            const avgDealSize = totalInvestment / totalDeals;
            const sectors = new Set();
            Object.values(sectoral).forEach(year => {
                year.sectors.forEach(s => sectors.add(s));
            });

            const stats = [
                { value: `$${Math.round(totalInvestment)}M`, label: 'Total Investment' },
                { value: totalDeals, label: 'Total Deals' },
                { value: `$${avgDealSize.toFixed(1)}M`, label: 'Avg Deal Size' },
                { value: sectors.size, label: 'Active Sectors' }
            ];

            const statsHTML = stats.map(stat => `
                <div class="stat-card">
                    <span class="stat-value">${stat.value}</span>
                    <span class="stat-label">${stat.label}</span>
                </div>
            `).join('');

            document.getElementById('statsGrid').innerHTML = statsHTML;
        }

        function renderSankey() {
            const { sankey } = dashboardData;

            const data = [{
                type: "sankey",
                orientation: "h",
                node: {
                    pad: 20,
                    thickness: 25,
                    line: { color: colors.navy, width: 2 },
                    label: sankey.nodes.map(n => n.name),
                    color: colors.primary,
                    font: {
                        family: 'Roboto, sans-serif',
                        size: 14,
                        color: colors.navy
                    }
                },
                link: {
                    source: sankey.links.map(l => l.source),
                    target: sankey.links.map(l => l.target),
                    value: sankey.links.map(l => l.value),
                    color: sankey.links.map((_, i) => colors.primary[i % colors.primary.length] + '40'),
                    customdata: sankey.links.map(l => l.deal_count),
                    hovertemplate: '<b>%{source.label} → %{target.label}</b><br>' +
                                 'Investment: $%{value:.0f}M<br>' +
                                 'Deals: %{customdata}<extra></extra>'
                }
            }];

            const layout = {
                paper_bgcolor: 'white',
                plot_bgcolor: 'white',
                font: {
                    family: 'Roboto, sans-serif',
                    color: colors.navy,
                    size: 14
                },
                height: 500,
                margin: { l: 20, r: 20, t: 20, b: 20 },
                hoverlabel: {
                    bgcolor: 'white',
                    bordercolor: colors.beige,
                    font: {
                        family: 'Roboto, sans-serif',
                        color: colors.navy
                    }
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['lasso2d', 'select2d']
            };

            Plotly.newPlot('sankeyChart', data, layout, config);
        }

        function renderSectoralChart() {
            const { sectoral } = dashboardData;
            const years = Object.keys(sectoral).sort();

            const allSectors = new Set();
            years.forEach(year => {
                sectoral[year].sectors.forEach(s => allSectors.add(s));
            });

            const sectorArray = Array.from(allSectors);

            const series = sectorArray.map(sector => {
                const data = years.map(year => {
                    const sectorIdx = sectoral[year].sectors.indexOf(sector);
                    if (currentSectoralView === 'value') {
                        return sectorIdx >= 0 ? sectoral[year].values[sectorIdx] : 0;
                    } else {
                        return sectorIdx >= 0 ? sectoral[year].counts[sectorIdx] : 0;
                    }
                });

                return {
                    name: sector,
                    data: data
                };
            });

            const options = {
                ...commonChartOptions,
                chart: {
                    ...commonChartOptions.chart,
                    type: 'bar',
                    height: 450,
                    stacked: true
                },
                series: series,
                xaxis: {
                    ...commonChartOptions.xaxis,
                    categories: years,
                    title: {
                        text: 'Year',
                        style: {
                            color: colors.navy,
                            fontSize: '15px',
                            fontWeight: 600
                        }
                    }
                },
                yaxis: {
                    ...commonChartOptions.yaxis,
                    title: {
                        text: currentSectoralView === 'value' ? 'Investment (USD Millions)' : 'Number of Deals',
                        style: {
                            color: colors.navy,
                            fontSize: '15px',
                            fontWeight: 600
                        }
                    },
                    labels: {
                        ...commonChartOptions.yaxis.labels,
                        formatter: function(val) {
                            return Math.round(val);
                        }
                    }
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        borderRadius: 4,
                        columnWidth: '70%'
                    }
                },
                dataLabels: {
                    enabled: false
                },
                legend: {
                    ...commonChartOptions.legend,
                    position: 'bottom'
                }
            };

            if (window.sectoralChartInstance) {
                window.sectoralChartInstance.destroy();
            }
            window.sectoralChartInstance = new ApexCharts(document.querySelector("#sectoralChart"), options);
            window.sectoralChartInstance.render();
        }

        function toggleSectoralView(view) {
            currentSectoralView = view;

            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderSectoralChart();
        }

        // Initialize dashboard
        loadData();
    </script>
</body>
</html>
